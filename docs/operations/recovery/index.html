<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://spike.ist/main.css">
    <link rel="icon" href="https://spike.ist/assets/spike-favicon-16x16.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title>  | SPIKE Recovery Procedures </title>
</head>
<body>

<script>
        fetch('https://api.github.com/repos/spiffe/spike/releases/latest')
            .then((response) => {
                return response.json();
            })
            .then((data) => {
                let release_name = data.name;
                let html_url = data.html_url;
                release.innerHTML = `<a href='${html_url}'>${release_name}</a>`;
            });
    </script>
<main>
    
    <nav>
            <h1><a href="https:&#x2F;&#x2F;spike.ist&#x2F;"></a></h1>
            <div id="release"></div>
            <a href="javascript:void(0);" onclick="burger()" id="mobile" class="ms-Icon--GlobalNavButton"></a>
            <div id="trees">
                <input class="tree-toggle" type="checkbox" id="getting-started"
                           />
                    <label class="tree-toggle-label"
                           for="getting-started">Getting Started</label>

                    <ul class="subtree">
                        <li >
                                <a href="https://spike.ist/getting-started/guide/">Quickstart</a>
                            </li>

                            <li >
                                <a href="https://spike.ist/getting-started/alpha-release-notice/">Alpha Release Notice</a>
                            </li>

                            <li >
                                <a href="https://spike.ist/getting-started/configuration/">Configuring SPIKE</a>
                            </li>

                            </ul>
                <input class="tree-toggle" type="checkbox" id="community"
                           />
                    <label class="tree-toggle-label"
                           for="community">Community</label>

                    <ul class="subtree">
                        <li >
                                <a href="https://spike.ist/community/hello/">Hello Universe</a>
                            </li>

                            <li >
                                <a href="https://spike.ist/community/contact/">Contact Us</a>
                            </li>

                            <li >
                                <a href="https://spike.ist/community/presentations/">Presentations and Demos</a>
                            </li>

                            </ul>
                <input class="tree-toggle" type="checkbox" id="spike-architecture"
                           />
                    <label class="tree-toggle-label"
                           for="spike-architecture">SPIKE Architecture</label>

                    <ul class="subtree">
                        <li >
                                <a href="https://spike.ist/architecture/system-overview/">System Overview</a>
                            </li>

                            <li >
                                <a href="https://spike.ist/architecture/security-model/">SPIKE Security Model</a>
                            </li>

                            <li >
                                <a href="https://spike.ist/architecture/architectural-decision-records/">ADRs</a>
                            </li>

                            </ul>
                <input class="tree-toggle" type="checkbox" id="tracking"
                           />
                    <label class="tree-toggle-label"
                           for="tracking">Tracking</label>

                    <ul class="subtree">
                        <li >
                                <a href="https://spike.ist/tracking/changelog/">Changelog</a>
                            </li>

                            <li >
                                <a href="https://spike.ist/tracking/snapshots/">Documentation Snapshots</a>
                            </li>

                            </ul>
                <input class="tree-toggle" type="checkbox" id="operations"
                           checked/>
                    <label class="tree-toggle-label"
                           for="operations">Operations</label>

                    <ul class="subtree">
                        <li >
                                <a href="https://spike.ist/operations/build/">SPIKE Cross-Platform Build</a>
                            </li>

                            <li >
                                <a href="https://spike.ist/operations/production/">SPIKE Production Setup</a>
                            </li>

                            <li class="active">
                                <a href="https://spike.ist/operations/recovery/">SPIKE Recovery Procedures</a>
                            </li>

                            
                                    
                                    
                                        <ul id="toc">
                                            <li><a href="
                                                        https://spike.ist/operations/recovery/#spike-recovery-procedures">SPIKE Recovery Procedures</a>
                                                    <ul>
                                                            <li>
                                                                    <a href="https://spike.ist/operations/recovery/#spike-nexus-crash-recovery">SPIKE Nexus Crash Recovery</a>
                                                                </li>
                                                            <li>
                                                                    <a href="https://spike.ist/operations/recovery/#spike-keeper-crash-recovery">SPIKE Keeper Crash Recovery</a>
                                                                </li>
                                                            <li>
                                                                    <a href="https://spike.ist/operations/recovery/#complete-system-recovery">Complete System Recovery</a>
                                                                </li>
                                                            </ul>
                                                    </li>
                                            </ul>
                                    <li >
                                <a href="https://spike.ist/operations/release/">SPIKE Relase Management</a>
                            </li>

                            </ul>
                </div>
        </nav>
    <article>



        <div id="on_right">
                <span id="search-ico" class="ms-Icon--Search"></span>
            </div>
            <div class="search-container">
                <input id="search" type="search" placeholder="Search as you type...">
                <div class="search-results">
                    <div class="search-results__header"></div>
                    <ul class="search-results__items"></ul>
                </div>
            </div>
        <p style="background:#ffffff;text-align:center;padding:1em;
max-width: 800px;margin: 0 auto;
border-radius: 6px;margin-bottom: -0.5em;
padding-bottom: 1.5em;
box-shadow: rgba(0, 0, 0, 0.2) 0px 18px 50px -10px;
">
            Pssst... <a href="https://github.com/spiffe/spike"
        style="border-bottom: 2px solid #07bdd9"
        ><strong>‚≠êÔ∏è
            Star SPIKE on GitHub ‚≠êÔ∏è</strong></a>.<br>
            Spread the word about this amazing technology üê¢‚ö°Ô∏è.
        </p>


        <div id="wrap">
             
        <p><a href="/" title="Back to home"><img src="/assets/spike-banner.png" 
style="float:left;margin: 0 1em 0 1em;" alt="SPIKE Logo" /></a></p>
<h1 id="spike-recovery-procedures">SPIKE Recovery Procedures</h1>
<p>SPIKE ensures that your secrets are secure and resilient, aiming for seamless
operations even in the most challenging situations. This document outlines the
steps required for recovering SPIKE in various scenarios, ensuring
you have the right guidance to handle any eventuality.</p>
<h2 id="spike-nexus-crash-recovery">SPIKE Nexus Crash Recovery</h2>
<p><strong>SPIKE</strong> is designed to automatically recover <strong>SPIKE Nexus</strong> from crashes.
Here is how this happens:</p>
<ol>
<li><strong>SPIKE Nexus</strong> crashes.</li>
<li>New <strong>SPIKE Nexus</strong> instance starts.</li>
<li><strong>SPIKE Nexus</strong> ask for shards from <strong>SPIKE Keeper</strong>s.</li>
<li>Once <strong>SPIKE Nexus</strong> gathers adequate shards, it recreates its <strong>root key</strong>
and resumes normal operations.</li>
</ol>
<h2 id="spike-keeper-crash-recovery">SPIKE Keeper Crash Recovery</h2>
<p><strong>SPIKE Keeper</strong> recovery is automatic, and does not require any manual
intervention.</p>
<p><strong>SPIKE Nexus</strong> regularly sends the shard that a <strong>SPIKE Keeper</strong> has to store.
So, if a <strong>SPIKE Keeper</strong> instance crashes, it will eventually receive its
shard.</p>
<h2 id="complete-system-recovery">Complete System Recovery</h2>
<p>In the unlikely case that both <strong>SPIKE Nexus</strong> and all <strong>SPIKE Keeper</strong>
instances crash all together, the system may transition to a state where
it cannot automatically recover.</p>
<p>In that case manual intervention will be necessary.</p>
<p>Here are the steps to take for this scenario:</p>
<ol>
<li>Before complete system failure:</li>
</ol>
<ul>
<li>Change the <strong>SPIFFE ID</strong> of <strong>SPIKE Pilot</strong> to recovery mode by
executing <code>./hack/spire-server-entry-recover-register.sh</code></li>
<li>Run <code>spike recover</code></li>
<li>Save the files generated in <code>~/.spike/recover</code> folder to a safe,
encrypted, and password-protected medium.</li>
<li>Securely erase the ~/.spike/recover` folder.</li>
<li>Change the <strong>SPIFFE ID</strong> of <strong>SPIKE Pilot</strong> back using
<code>./hack/spire-server-entry-su-register.sh</code> or delete the registration
entry entirely for extra security.</li>
<li>You can create the entry back using
<code>./hack/spire-server-entry-su-register.sh</code> when you need to use
<strong>SPIKE Pilot</strong>.</li>
</ul>
<ol start="2">
<li>During complete system failure:</li>
</ol>
<ul>
<li>Change the <strong>SPIFFE ID</strong> of <strong>SPIKE Pilot</strong> to restore mode:
<code>./hack/spire-server-entry-restore-register.sh</code></li>
<li>Execute <code>spike restore</code> and enter the shards you created in the
previous step one by one. Each <code>spike restore</code> call accepts a
single shard.</li>
<li>When you provide enough shards, the system will restore itself:
<strong>SPIKE Nexus</strong> will restore its root key, and it will also hydrate
its peer <strong>SPIKE Keeper</strong> instances to protect itself against future
crashes.</li>
<li>Change the <strong>SPIFFE ID</strong> of <strong>SPIKE Pilot</strong> back using
<code>./hack/spire-server-entry-su-register.sh</code> or delete the registration
entry entirely for extra security.
<ul>
<li>You can create the entry back using
<code>./hack/spire-server-entry-su-register.sh</code> when you need to use
<strong>SPIKE Pilot</strong>.</li>
</ul>
</li>
</ul>
<ol>
<li>Both <strong>SPIKE Nexus</strong>, <strong>SPIKE Keeper</strong> are unavailable, or the system is
in on other irrecoverable state.</li>
<li>Admin executes <code>spike recover</code>.</li>
<li>Admin provides their <strong>password</strong>.</li>
<li>The encrypted <strong>root key</strong> is fetched from the database and injected to
the memory of <strong>SPIKE Nexus</strong>.</li>
<li><strong>SPIKE Nexus</strong> syncs the <strong>root key</strong> with <strong>SPIKE Keeper</strong>.</li>
<li>The system resumes normal operation.</li>
</ol>
<h3 id="total-system-reset">Total System Reset</h3>
<p>This procedure is for resetting <strong>SPIKE</strong> to its factory defaults.</p>
<p>The situation:</p>
<ul>
<li>Both <strong>SPIKE Nexus</strong> and all <strong>SPIKE Keeper</strong> instances have crashed, there
is no way to fetch the root key from <strong>SPIKE Keeper</strong>(s).</li>
<li>The system administrator has not used <code>spike recover</code> to create recovery
shards, or they have lost access to the recovery shards.</li>
<li>Everyone have learned their lessons, and now it‚Äôs time to reset the system
and conduct an extensive ‚Äúwhat went wrong / what should have been done‚Äù
analysis.</li>
</ul>
<p>How to proceed:</p>
<ul>
<li>Delete <code>~/.spike</code> folder, which will also delete all the persisted secrets
in the SQLite backing store.</li>
<li>Delete <strong>SPIRE Server</strong> registration entries.</li>
<li>Redeploy <strong>SPIKE</strong> using your preferred method.
<ul>
<li>You can check out <code>./hack/start.sh</code> to see a sample startup/deployment
script.</li>
</ul>
</li>
<li>This is a complete system reset; you‚Äôll lose all data and all former
configuration, including secret access policies.</li>
</ul>
<hr />
<ul>
<li><a href="https://spike.ist/operations/build/">SPIKE Cross-Platform Build</a></li>
<li><a href="https://spike.ist/operations/production/">SPIKE Production Setup</a></li>
<li><a href="https://spike.ist/operations/recovery/">SPIKE Recovery Procedures</a></li>
<li><a href="https://spike.ist/operations/release/">SPIKE Release Management</a></li>
</ul>
<hr />
<ul>
<li><a href="https://spike.ist/getting-started/">Getting Started</a></li>
<li><a href="https://spike.ist/community/">Community</a></li>
<li><a href="https://spike.ist/architecture/">SPIKE Architecture</a></li>
<li><a href="https://spike.ist/operations/">Operations</a></li>
<li><a href="https://spike.ist/tracking/">Tracking</a></li>
</ul>

    

        </div>
        <footer style="padding:1em;padding-top:1em;padding-bottom:1em;
font-size: 14px;
margin-top: 2em;
max-width: 550px;
margin: 2em auto;
" id="footer">

            Copyright ¬© 2024-present <strong>SPIKE Contributors</strong>.<br>
            <strong>SPIKE</strong>'s code
            is distributed under <a class="text-blue-600 underline" href="https://www.mozilla.org/en-US/MPL/2.0/">Mozilla Public License (v2.0)</a>.
            <br>
            The documentation on this website
            is distributed under <a class="text-blue-600 underline" href="https://creativecommons.org/licenses/by/4.0/">CC-BY-4.0</a>.
            <br><br>
            We <strong>do not</strong> collect your data.
            This site <strong>does not</strong> use any tracking cookies or scripts.
        </footer>



    </article>

</main>


    <script type="text/javascript" src="https://spike.ist/elasticlunr.min.js" defer></script>
    <script type="text/javascript" src="https://spike.ist/search_index.en.js" defer></script>
<script type="text/javascript" src="https://spike.ist/js.js" defer></script>
</body>
</html>
